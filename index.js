"use strict";(()=>{var wt=Object.defineProperty;var v=(t,e)=>{for(var o in e)wt(t,o,{get:e[o],enumerable:!0})};var M={};v(M,{Flux:()=>k,FluxDispatcher:()=>m,React:()=>l,ReactDOM:()=>bt});var j={};v(j,{find:()=>F,findAll:()=>L,findByDisplayName:()=>x,findByDisplayNameAll:()=>St,findByProps:()=>d,findByPropsAll:()=>Ct,modules:()=>_});var tt=window.webpackJsonp([],[(t,e,o)=>{t.exports=o}]);var et=(t,e=!1)=>o=>{let r=[];for(let i in t)if(t.hasOwnProperty(i)){let n=t[i].exports;if(!n)continue;if(n.default&&n.__esModule&&o(n.default)){if(e)return n.default;r.push(n.default)}if(o(n)){if(e)return n;r.push(n)}}if(!e)return r},_=tt.c,F=et(_,!0),L=et(_),ot=t=>e=>t.every(o=>e[o]!==void 0),rt=(t,e)=>e?o=>o.displayName===t:o=>o?.default?.displayName===t,d=(...t)=>F(ot(t)),Ct=(...t)=>L(ot(t)),x=(t,e=!0)=>F(rt(t,e)),St=(t,e=!0)=>L(rt(t,e));var l=d("createElement"),bt=d("render","findDOMNode"),k=d("Store","initialize"),m=d("_isDispatching","dispatch");var B={};v(B,{after:()=>S,before:()=>xt,instead:()=>kt,unpatchAll:()=>T});var N=["a","b","i"],g=new Map;function nt(t,e,o,r,i){let n=g.get(e)?.[t];if(!n)return i?Reflect.construct(e[t],o,r):e[t].apply(r,o);for(let a of n.b.values()){let p=a.call(r,o);Array.isArray(p)&&(o=p)}let s=(...a)=>i?Reflect.construct(n.o,a,r):n.o.apply(r,a);for(let a of n.i.values()){let p=s;s=(...f)=>a.call(r,f,p)}let c=s(...o);for(let a of n.a.values())c=a.call(r,o,c)??c;return c}function U(t,e,o,r){let i=g.get(t),n=i?.[e];return n?.[r].has(o)?(n[r].delete(o),N.every(s=>n[s].size===0)&&(Reflect.defineProperty(t,e,{value:n.o,writable:!0,configurable:!0})||(t[e]=n.o),delete i[e]),Object.keys(i).length==0&&g.delete(t),!0):!1}function T(){for(let[t,e]of g.entries())for(let o in e)for(let r of N)for(let i of e[o]?.[r].keys()??[])U(t,o,i,r)}var D=t=>(e,o,r,i=!1)=>{if(typeof o[e]!="function")throw new Error(`${e} is not a function in ${o.constructor.name}`);g.has(o)||g.set(o,{});let n=g.get(o);if(!n[e]){let a=o[e];n[e]={o:a,b:new Map,i:new Map,a:new Map};let p=(u,h,C)=>{let P=nt(e,o,h,u,C);return i&&c(),P},f=new Proxy(a,{apply:(u,h,C)=>p(h,C,!1),construct:(u,h)=>p(a,h,!0),get:(u,h,C)=>h=="toString"?a.toString.bind(a):Reflect.get(u,h,C)});Reflect.defineProperty(o,e,{value:f,configurable:!0,writable:!0})||(o[e]=f)}let s=Symbol(),c=()=>U(o,e,s,t);return n[e][t].set(s,r),c};var xt=D("b"),kt=D("i"),S=D("a");function I(t){let e=document.createElement("style");return e.id="CORDWOOD_INJECTED_STYLE",e.innerHTML=t,document.head.appendChild(e),()=>{e.remove()}}var it={...B,injectCSS:I};var Ot=d("showChangeLog");function G(){S("showChangeLog",Ot,()=>{m.dispatch({type:"CHANGE_LOG_OPEN"})})}function Tt(t,e,o){if(t===e)return!0;let r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(let n=0;n<r.length;n++){let s=r[n];if(t[s]!==e[s]&&(o==null||o.indexOf(s)===-1))return!1}return!0}function Dt(t){return t.displayName||t.name||"Component"}function H(t,e){return o=>class extends l.Component{static displayName=`FluxContainer(${Dt(o)})`;constructor(r){super(r),this.state=e(r),this._handleStoreChange=this._handleStoreChange.bind(this)}_handleStoreChange(){this.setState(e(this.props))}componentWillMount(){t.forEach(r=>{r.addChangeListener(this._handleStoreChange)})}componentWillReceiveProps(r){Tt(this.props,r)||this.setState(e(r))}componentWillUnmount(){t.forEach(r=>r.removeChangeListener(this._handleStoreChange))}render(){return l.createElement(o,{...this.props,...this.state},null)}}}function O(t){return new Promise((e,o)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>o(t.error)})}function Et(t,e){let o=indexedDB.open(t);o.onupgradeneeded=()=>o.result.createObjectStore(e);let r=O(o);return(i,n)=>r.then(s=>n(s.transaction(e,i).objectStore(e)))}var W;function E(){return W||(W=Et("keyval-store","keyval")),W}function st(t,e=E()){return e("readonly",o=>O(o.get(t)))}function at(t,e,o=E()){return o("readwrite",r=>(r.put(e,t),O(r.transaction)))}function ct(t,e=E()){return e("readwrite",o=>(o.delete(t),O(o.transaction)))}function lt(t=E()){return t("readwrite",e=>(e.clear(),O(e.transaction)))}var $=class{async get(e,o=null){let r=await st(e);return r||(r=o),r}async set(e,o){await at(e,o)}async remove(e){await ct(e)}async clear(){await lt()}},w=new $;var pt="CordwoodSettingsStore",K={switch:!1};async function dt(t){let e=!1,o={};for(let[r,i]of Object.entries(t))i!=null&&(e=!0,K[r]=i),o[r]=K[r];return e&&await w.set(pt,o),e}var z=class extends k.Store{constructor(e,o){super(e,o)}async initialize(){let e=await w.get(pt);e!=null&&await dt(e)}getSwitch(){return K.switch}},J=new z(m,async t=>{switch(t.type){case"CORDWOOD_SETTINGS_UPDATE":return await dt(t.settings);default:return!1}});var ut={setSwitch(t){m.dispatch({type:"CORDWOOD_SETTINGS_UPDATE",settings:{switch:t}})}};var At=x("Checkbox"),V=class extends l.Component{constructor(e={}){super(e),this.state={toggled:0}}render(){return l.createElement("div",{className:"margin-top-20"},l.createElement(At,{onChange:e=>{ut.setSwitch(e.target.checked)},defaultChecked:this.props.switch}))}},Y=H([J],()=>({switch:J.getSwitch()}))(V);var b=d("defaultRules","parserFor"),ht=d("getDefaultRules","parserFor"),Rt=ht.getDefaultRules(),Pt=b.defaultRules.lheading,ft=b.defaultRules.link,vt=b.defaultRules.image,_t=ht.parserFor({...Rt,image:{...vt},link:{...ft},list:b.defaultRules.list,lheading:{...Pt,parse(t,e,o){return{className:/\{(.+?)}/.exec(t[1])[1],level:t[2]==="="?1:2,content:b.parseInline(e,t[1].replace(/\{.+?}/,""),o)}},react(t,e,o){return l.createElement(`h${t.level}`,{key:o.key,className:t.className},e(t.content,o))}},shortlink:{shortlinks:{gh:"github.com",srht:"git.sr.ht"},regex:/^\[(.+?)\]\((.+?):([^\/].+?)\)/,order:ft.order-.5,match(t){return this.regex.exec(t)},parse(t,e,o){return{content:b.parseInline(e,t[1],o),target:`https://${this.shortlinks[t[2]]}/${t[3]}`}},react(t,e,o){return l.createElement("a",{href:t.target},e(t.content,o))}}}),gt=({changelog:t})=>l.createElement("div",null,_t(t.body,!1));function q(){G();let t=d("UserSettingsModalSections");Object.assign(t.UserSettingsModalSections,{CORDWOOD:"CORDWOOD"});let e=d("getUserSettingsModalSections");S("getUserSettingsModalSections",e,(r,i)=>{i.push({section:t.UserSettingsModalSections.CORDWOOD,label:"Cordwood",element:Y})});let o=d("TabBarItem","TabBarHeader","TabBarSeparator");S("render",e.default.prototype,(r,i)=>{i.props.children[0].props.children.props.children[1].push(l.createElement(o.TabBarHeader,{className:"cordwood-settings-header"},"Cordwood"),l.createElement(o.TabBarItem,{key:"CORDWOOD"},"Plugins"),l.createElement("div",{className:"cordwood-changelog-button",onClick:()=>{Ft(),m.dispatch({type:"CHANGE_LOG_OPEN"})}},"Cordwood Change Log")),i.props.children[0].props.children.props.selectedItem==="CORDWOOD"&&(i.props.children[1].props.children[0].props.children=l.createElement(Y,null))})}function Ft(){let t=x("MarkdownModal");S("render",t.prototype,(e,o)=>{if(!o.props.className.includes("change-log"))return o;let i=window.cordwood.changelog.replace(/\r/g,"").split(`---changelog---
`).slice(1).map(a=>{let p=!1,f={},y=a.split(`
`).filter(u=>{if(u==="---")return p=!0,!1;if(!p){let h=u.split(": "),C=h.shift(),P=h.join(": ");f[C]=JSON.parse(P)}return p}).join(`
`);return{...f,body:y}})[0],n=o.props.children[0].props.children[0];n[0].props.children="Cordwood Changelog",n[1]=` (${i.date})`;let s=o.props.children[2].props.children;s[1].props.href="https://github.com/Cordwood/Cordwood/blob/master/CHANGELOG.md";let c=o.props.children[1];return c.props.children[0]=null,c.props.children[1]=[l.createElement(gt,{changelog:i})],o},!0)}var Q=(t,e,o)=>{console[o]("%cCordwood%c",`background-color: ${e}; color: black; font-weight: 600; border-radius: 16px; padding: 0px 5px 0px 5px;`,"",t)},A={log:t=>Q(t,"#b6c76c","log"),warn:t=>Q(t,"#e19c3d","warn"),error:t=>Q(t,"#a63d40","error")};function R(t,e,{walkable:o=[],ignore:r=[],maxDepth:i=100}={}){let n=0;function s(c,a,{walkable:p=[],ignore:f=[]}={}){if(n+=1,!(n>i)){if(typeof a=="string"){if(c.hasOwnProperty(a))return c[a]}else if(a(c))return c;if(!!c){if(Array.isArray(c))for(let y of c){let u=s(y,a,{walkable:p,ignore:f});if(u)return u}else if(typeof c=="object"){for(let y of Object.keys(c))if(!(p!=null&&p.includes(y))&&!f.includes(y))try{let u=s(c[y],a,{walkable:p,ignore:f});if(u)return u}catch{}}}}}return s(t,e,{walkable:o,ignore:r})}function mt(t,e){R(t,e,{walkable:["props","children","child","sibling"]})}async function X(t){let e={cache:"no-cache"},o=new URL(t.endsWith("/")?t:t+"/"),r=await fetch(o+"manifest.json",e);if(!r.ok)throw new Error(`Could not load manifest for plugin at ${t}`);let i;try{i=await r.json()}catch{throw new Error(`Could not parse manifest for plugin at ${t}`)}let n;try{n=await(await fetch(o+"index.js",e)).text()}catch{throw new Error(`Could not load main file for plugin at ${t}`)}return{manifest:i,url:o,main:n}}var Lt=window.eval;async function Z(t){window.cordwood.plugins.loaded.push(t);let e=Lt(t.main)(window.cordwood);e.onLoad&&e.onLoad()}if(window.cordwood)throw new Error("Cordwood is already injected...");var yt=!1;try{q(),k.initialize();let t=I(".cordwood-settings-header{padding-bottom:1rem}.cordwood-changelog-button{cursor:pointer;display:block!important;color:#faa61a!important;font-size:12px!important;padding:8px 6px 10px 20px!important;opacity:.7;-webkit-transition:opacity .2s!important;transition:opacity .2s}.cordwood-changelog-button:hover{opacity:1;color:#faa61a}");window.cordwood={utils:{logger:A,findInTree:R,findInReactTree:mt,storage:{get:w.get,set:w.set,remove:w.remove,clear:w.clear}},patcher:{...it},webpack:{...j,common:{...M}},plugins:{importPlugin:X,loadPlugin:Z,loaded:new Array},uninject:()=>{T(),t(),delete window.cordwood}},fetch("https://raw.githubusercontent.com/Cordwood/Cordwood/master/CHANGELOG.md",{cache:"no-store"}).then(e=>e.text().then(o=>Object.assign(window.cordwood,{changelog:o})))}catch(t){yt=!0,A.error(`Cordwood failed to initialize... ${t.stack?t.stack:t.toString()}`)}yt||A.log("Loaded successfully!");})();
//# sourceURL=Cordwood