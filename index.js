"use strict";(()=>{var bt=Object.defineProperty;var j=(t,e)=>{for(var o in e)bt(t,o,{get:e[o],enumerable:!0})};var N={};j(N,{Flux:()=>O,FluxDispatcher:()=>m,React:()=>l,ReactDOM:()=>kt});var M={};j(M,{find:()=>L,findAll:()=>F,findByDisplayName:()=>x,findByDisplayNameAll:()=>Ot,findByProps:()=>d,findByPropsAll:()=>xt,modules:()=>_});var rt=window.webpackJsonp([],[(t,e,o)=>{t.exports=o}]);var nt=(t,e=!1)=>o=>{let r=[];for(let i in t)if(t.hasOwnProperty(i)){let n=t[i].exports;if(!n)continue;if(n.default&&n.__esModule&&o(n.default)){if(e)return n.default;r.push(n.default)}if(o(n)){if(e)return n;r.push(n)}}if(!e)return r},_=rt.c,L=nt(_,!0),F=nt(_),it=t=>e=>t.every(o=>e[o]!==void 0),st=(t,e)=>e?o=>o.displayName===t:o=>o?.default?.displayName===t,d=(...t)=>L(it(t)),xt=(...t)=>F(it(t)),x=(t,e=!0)=>L(st(t,e)),Ot=(t,e=!0)=>F(st(t,e));var l=d("createElement"),kt=d("render","findDOMNode"),O=d("Store","initialize"),m=d("_isDispatching","dispatch");var I={};j(I,{after:()=>C,before:()=>Tt,instead:()=>At,unpatchAll:()=>A});var U=["a","b","i"],g=new Map;function at(t,e,o,r,i){let n=g.get(e)?.[t];if(!n)return i?Reflect.construct(e[t],o,r):e[t].apply(r,o);for(let c of n.b.values()){let p=c.call(r,o);Array.isArray(p)&&(o=p)}let s=(...c)=>i?Reflect.construct(n.o,c,r):n.o.apply(r,c);for(let c of n.i.values()){let p=s;s=(...f)=>c.call(r,f,p)}let a=s(...o);for(let c of n.a.values())a=c.call(r,o,a)??a;return a}function B(t,e,o,r){let i=g.get(t),n=i?.[e];return n?.[r].has(o)?(n[r].delete(o),U.every(s=>n[s].size===0)&&(Reflect.defineProperty(t,e,{value:n.o,writable:!0,configurable:!0})||(t[e]=n.o),delete i[e]),Object.keys(i).length==0&&g.delete(t),!0):!1}function A(){for(let[t,e]of g.entries())for(let o in e)for(let r of U)for(let i of e[o]?.[r].keys()??[])B(t,o,i,r)}var D=t=>(e,o,r,i=!1)=>{if(typeof o[e]!="function")throw new Error(`${e} is not a function in ${o.constructor.name}`);g.has(o)||g.set(o,{});let n=g.get(o);if(!n[e]){let c=o[e];n[e]={o:c,b:new Map,i:new Map,a:new Map};let p=(u,h,S)=>{let v=at(e,o,h,u,S);return i&&a(),v},f=new Proxy(c,{apply:(u,h,S)=>p(h,S,!1),construct:(u,h)=>p(c,h,!0),get:(u,h,S)=>h=="toString"?c.toString.bind(c):Reflect.get(u,h,S)});Reflect.defineProperty(o,e,{value:f,configurable:!0,writable:!0})||(o[e]=f)}let s=Symbol(),a=()=>B(o,e,s,t);return n[e][t].set(s,r),a};var Tt=D("b"),At=D("i"),C=D("a");var ct=new Array;function G(t){let e=document.createElement("style");e.id="CORDWOOD_INJECTED_STYLE",e.innerHTML=t,document.head.appendChild(e),ct.push(o);function o(){e.remove()}return o}function $(){for(let t of ct)t()}var lt={...I,injectCSS:G,clearStyles:$};var Dt=d("showChangeLog");function H(){C("showChangeLog",Dt,()=>{m.dispatch({type:"CHANGE_LOG_OPEN"})})}function Et(t,e,o){if(t===e)return!0;let r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(let n=0;n<r.length;n++){let s=r[n];if(t[s]!==e[s]&&(o==null||o.indexOf(s)===-1))return!1}return!0}function Rt(t){return t.displayName||t.name||"Component"}function W(t,e){return o=>class extends l.Component{static displayName=`FluxContainer(${Rt(o)})`;constructor(r){super(r),this.state=e(r),this._handleStoreChange=this._handleStoreChange.bind(this)}_handleStoreChange(){this.setState(e(this.props))}componentWillMount(){t.forEach(r=>{r.addChangeListener(this._handleStoreChange)})}componentWillReceiveProps(r){Et(this.props,r)||this.setState(e(r))}componentWillUnmount(){t.forEach(r=>r.removeChangeListener(this._handleStoreChange))}render(){return l.createElement(o,{...this.props,...this.state},null)}}}function k(t){return new Promise((e,o)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>o(t.error)})}function Pt(t,e){let o=indexedDB.open(t);o.onupgradeneeded=()=>o.result.createObjectStore(e);let r=k(o);return(i,n)=>r.then(s=>n(s.transaction(e,i).objectStore(e)))}var K;function E(){return K||(K=Pt("keyval-store","keyval")),K}function pt(t,e=E()){return e("readonly",o=>k(o.get(t)))}function dt(t,e,o=E()){return o("readwrite",r=>(r.put(e,t),k(r.transaction)))}function ut(t,e=E()){return e("readwrite",o=>(o.delete(t),k(o.transaction)))}function ft(t=E()){return t("readwrite",e=>(e.clear(),k(e.transaction)))}var z=class{async get(e,o=null){let r=await pt(e);return r||(r=o),r}async set(e,o){await dt(e,o)}async remove(e){await ut(e)}async clear(){await ft()}},w=new z;var ht="CordwoodSettingsStore",J={switch:!1};async function gt(t){let e=!1,o={};for(let[r,i]of Object.entries(t))i!=null&&(e=!0,J[r]=i),o[r]=J[r];return e&&await w.set(ht,o),e}var V=class extends O.Store{constructor(e,o){super(e,o)}async initialize(){let e=await w.get(ht);e!=null&&await gt(e)}getSwitch(){return J.switch}},Y=new V(m,async t=>{switch(t.type){case"CORDWOOD_SETTINGS_UPDATE":return await gt(t.settings);default:return!1}});var mt={setSwitch(t){m.dispatch({type:"CORDWOOD_SETTINGS_UPDATE",settings:{switch:t}})}};var vt=x("Checkbox"),q=class extends l.Component{constructor(e={}){super(e),this.state={toggled:0}}render(){return l.createElement("div",{className:"margin-top-20"},l.createElement(vt,{onChange:e=>{mt.setSwitch(e.target.checked)},defaultChecked:this.props.switch}))}},Z=W([Y],()=>({switch:Y.getSwitch()}))(q);var b=d("defaultRules","parserFor"),wt=d("getDefaultRules","parserFor"),jt=wt.getDefaultRules(),_t=b.defaultRules.lheading,yt=b.defaultRules.link,Lt=b.defaultRules.image,Ft=wt.parserFor({...jt,image:{...Lt},link:{...yt},list:b.defaultRules.list,lheading:{..._t,parse(t,e,o){return{className:/\{(.+?)}/.exec(t[1])[1],level:t[2]==="="?1:2,content:b.parseInline(e,t[1].replace(/\{.+?}/,""),o)}},react(t,e,o){return l.createElement(`h${t.level}`,{key:o.key,className:t.className},e(t.content,o))}},shortlink:{shortlinks:{gh:"github.com",srht:"git.sr.ht"},regex:/^\[(.+?)\]\((.+?):([^\/].+?)\)/,order:yt.order-.5,match(t){return this.regex.exec(t)},parse(t,e,o){return{content:b.parseInline(e,t[1],o),target:`https://${this.shortlinks[t[2]]}/${t[3]}`}},react(t,e,o){return l.createElement("a",{href:t.target},e(t.content,o))}}}),St=({changelog:t})=>l.createElement("div",null,Ft(t.body,!1));function Q(){H();let t=d("UserSettingsModalSections");Object.assign(t.UserSettingsModalSections,{CORDWOOD:"CORDWOOD"});let e=d("getUserSettingsModalSections");C("getUserSettingsModalSections",e,(r,i)=>{i.push({section:t.UserSettingsModalSections.CORDWOOD,label:"Cordwood",element:Z})});let o=d("TabBarItem","TabBarHeader","TabBarSeparator");C("render",e.default.prototype,(r,i)=>{i.props.children[0].props.children.props.children[1].push(l.createElement(o.TabBarHeader,{className:"cordwood-settings-header"},"Cordwood"),l.createElement(o.TabBarItem,{key:"CORDWOOD"},"Plugins"),l.createElement("div",{className:"cordwood-changelog-button",onClick:()=>{Mt(),m.dispatch({type:"CHANGE_LOG_OPEN"})}},"Cordwood Change Log")),i.props.children[0].props.children.props.selectedItem==="CORDWOOD"&&(i.props.children[1].props.children[0].props.children=l.createElement(Z,null))})}function Mt(){let t=x("MarkdownModal");C("render",t.prototype,(e,o)=>{if(!o.props.className.includes("change-log"))return o;let i=window.cordwood.changelog.replace(/\r/g,"").split(`---changelog---
`).slice(1).map(c=>{let p=!1,f={},y=c.split(`
`).filter(u=>{if(u==="---")return p=!0,!1;if(!p){let h=u.split(": "),S=h.shift(),v=h.join(": ");f[S]=JSON.parse(v)}return p}).join(`
`);return{...f,body:y}})[0],n=o.props.children[0].props.children[0];n[0].props.children="Cordwood Changelog",n[1]=` (${i.date})`;let s=o.props.children[2].props.children;s[1].props.href="https://github.com/Cordwood/Cordwood/blob/master/CHANGELOG.md";let a=o.props.children[1];return a.props.children[0]=null,a.props.children[1]=[l.createElement(St,{changelog:i})],o},!0)}var X=(t,e,o)=>{console[o]("%cCordwood%c",`background-color: ${e}; color: black; font-weight: 600; border-radius: 16px; padding: 0px 5px 0px 5px;`,"",t)},R={log:t=>X(t,"#b6c76c","log"),warn:t=>X(t,"#e19c3d","warn"),error:t=>X(t,"#a63d40","error")};function T(t,e,{walkable:o=[],ignore:r=[],maxDepth:i=100}={}){let n=0;function s(a,c,{walkable:p=[],ignore:f=[]}={}){if(n+=1,!(n>i)){if(typeof c=="string"){if(a.hasOwnProperty(c))return a[c]}else if(c(a))return a;if(!!a){if(Array.isArray(a))for(let y of a){let u=s(y,c,{walkable:p,ignore:f});if(u)return u}else if(typeof a=="object"){for(let y of Object.keys(a))if(!(p!=null&&p.includes(y))&&!f.includes(y))try{let u=s(a[y],c,{walkable:p,ignore:f});if(u)return u}catch{}}}}}return s(t,e,{walkable:o,ignore:r})}function tt(t,e){T(t,e,{walkable:["props","children","child","sibling"]})}function P(t){let e=new Array;for(let[o,r]of Object.entries(t)){let i=Object.entries(r).map(([n,s])=>`${n.replace(/[A-Z]/g,a=>`-${a.toLowerCase()}`)}:${s}`).join(";");e.push(`${o}{${i}}`)}return e.join("")}async function et(t){let e={cache:"no-cache"},o=new URL(t.endsWith("/")?t:t+"/"),r=await fetch(o+"manifest.json",e);if(!r.ok)throw new Error(`Could not load manifest for plugin at ${t}`);let i;try{i=await r.json()}catch{throw new Error(`Could not parse manifest for plugin at ${t}`)}let n;try{n=await(await fetch(o+"index.js",e)).text()}catch{throw new Error(`Could not load main file for plugin at ${t}`)}return{manifest:i,url:o,main:n}}var Nt=window.eval;async function ot(t){window.cordwood.plugins.loaded.push(t);let e=Nt(t.main)(window.cordwood);e.onLoad&&e.onLoad()}if(window.cordwood)throw new Error("Cordwood is already injected...");var Ct=!1;try{Q(),O.initialize(),G(P({".cordwood-settings-header":{paddingBottom:"1rem"},".cordwood-changelog-button":{cursor:"pointer",display:"block !important",color:"#faa61a !important",fontSize:"12px !important",padding:"8px 6px 10px 20px !important",opacity:.7,"-webkit-transition":"opacity .2s !important",transition:"opacity .2s"},".cordwood-changelog-button:hover":{opacity:1,color:"#faa61a"}})),window.cordwood={utils:{logger:R,findInTree:T,findInReactTree:tt,storage:{get:w.get,set:w.set,remove:w.remove,clear:w.clear},createStyle:P},patcher:{...lt},webpack:{...M,common:{...N}},plugins:{importPlugin:et,loadPlugin:ot,loaded:new Array},uninject:()=>{A(),$(),delete window.cordwood}},fetch("https://raw.githubusercontent.com/Cordwood/Cordwood/master/CHANGELOG.md",{cache:"no-store"}).then(t=>t.text().then(e=>Object.assign(window.cordwood,{changelog:e})))}catch(t){Ct=!0,R.error(`Cordwood failed to initialize... ${t.stack?t.stack:t.toString()}`)}Ct||R.log("Loaded successfully!");})();
//# sourceURL=Cordwood