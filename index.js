"use strict";(()=>{var ft=Object.defineProperty;var R=(t,e)=>{for(var o in e)ft(t,o,{get:e[o],enumerable:!0})};var v={};R(v,{Flux:()=>x,FluxDispatcher:()=>m,React:()=>l,ReactDOM:()=>gt});var L={};R(L,{find:()=>P,findAll:()=>_,findByDisplayName:()=>b,findByDisplayNameAll:()=>ht,findByProps:()=>d,findByPropsAll:()=>ut,modules:()=>A});var Q=window.webpackJsonp([],[(t,e,o)=>{t.exports=o}]);var X=(t,e=!1)=>o=>{let r=[];for(let s in t)if(t.hasOwnProperty(s)){let n=t[s].exports;if(!n)continue;if(n.default&&n.__esModule&&o(n.default)){if(e)return n.default;r.push(n.default)}if(o(n)){if(e)return n;r.push(n)}}if(!e)return r},A=Q.c,P=X(A,!0),_=X(A),Z=t=>e=>t.every(o=>e[o]!==void 0),tt=(t,e)=>e?o=>o.displayName===t:o=>o?.default?.displayName===t,d=(...t)=>P(Z(t)),ut=(...t)=>_(Z(t)),b=(t,e=!0)=>P(tt(t,e)),ht=(t,e=!0)=>_(tt(t,e));var l=d("createElement"),gt=d("render","findDOMNode"),x=d("Store","initialize"),m=d("_isDispatching","dispatch");var F={};R(F,{after:()=>S,before:()=>mt,instead:()=>yt,unpatchAll:()=>O});var N=["a","b","i"],g=new Map;function et(t,e,o,r,s){let n=g.get(e)?.[t];if(!n)return s?Reflect.construct(e[t],o,r):e[t].apply(r,o);for(let i of n.b.values()){let p=i.call(r,o);Array.isArray(p)&&(o=p)}let a=(...i)=>s?Reflect.construct(n.o,i,r):n.o.apply(r,i);for(let i of n.i.values()){let p=a;a=(...u)=>i.call(r,u,p)}let c=a(...o);for(let i of n.a.values())c=i.call(r,o,c)??c;return c}function j(t,e,o,r){let s=g.get(t),n=s?.[e];return n?.[r].has(o)?(n[r].delete(o),N.every(a=>n[a].size===0)&&(Reflect.defineProperty(t,e,{value:n.o,writable:!0,configurable:!0})||(t[e]=n.o),delete s[e]),Object.keys(s).length==0&&g.delete(t),!0):!1}function O(){for(let[t,e]of g.entries())for(let o in e)for(let r of N)for(let s of e[o]?.[r].keys()??[])j(t,o,s,r)}var k=t=>(e,o,r,s=!1)=>{if(typeof o[e]!="function")throw new Error(`${e} is not a function in ${o.constructor.name}`);g.has(o)||g.set(o,{});let n=g.get(o);if(!n[e]){let i=o[e];n[e]={o:i,b:new Map,i:new Map,a:new Map};let p=(f,h,w)=>{let E=et(e,o,h,f,w);return s&&c(),E},u=new Proxy(i,{apply:(f,h,w)=>p(h,w,!1),construct:(f,h)=>p(i,h,!0),get:(f,h,w)=>h=="toString"?i.toString.bind(i):Reflect.get(f,h,w)});Reflect.defineProperty(o,e,{value:u,configurable:!0,writable:!0})||(o[e]=u)}let a=Symbol(),c=()=>j(o,e,a,t);return n[e][t].set(a,r),c};var mt=k("b"),yt=k("i"),S=k("a");function M(t){let e=document.createElement("style");return e.id="CORDWOOD_INJECTED_STYLE",e.innerHTML=t,document.head.appendChild(e),()=>{e.remove()}}var ot={...F,injectCSS:M};var wt=d("showChangeLog");function U(){S("showChangeLog",wt,()=>{m.dispatch({type:"CHANGE_LOG_OPEN"})})}function St(t,e,o){if(t===e)return!0;let r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++){let a=r[n];if(t[a]!==e[a]&&(o==null||o.indexOf(a)===-1))return!1}return!0}function Ct(t){return t.displayName||t.name||"Component"}function I(t,e){return o=>class extends l.Component{static displayName=`FluxContainer(${Ct(o)})`;constructor(r){super(r),this.state=e(r),this._handleStoreChange=this._handleStoreChange.bind(this)}_handleStoreChange(){this.setState(e(this.props))}componentWillMount(){t.forEach(r=>{r.addChangeListener(this._handleStoreChange)})}componentWillReceiveProps(r){St(this.props,r)||this.setState(e(r))}componentWillUnmount(){t.forEach(r=>r.removeChangeListener(this._handleStoreChange))}render(){return l.createElement(o,{...this.props,...this.state},null)}}}function bt(){let t=document.createElement("frame");t.src="about:blank",document.body.appendChild(t);let e=Object.getOwnPropertyDescriptor(t.contentWindow,"localStorage");return t.remove(),e}function rt(){return Object.defineProperty(window,"localStorage",{...bt()}),()=>{delete window.localStorage}}var B=class{get(e,o=null){let r=localStorage.getItem(e);if(r!=null)try{r=JSON.parse(r)}catch{r=o}else r=o;return r}set(e,o){localStorage.setItem(e,JSON.stringify(o))}remove(e){localStorage.removeItem(e)}clear(){localStorage.clear()}},G=new B;var nt="CordwoodSettingsStore",H={switch:!1};function st(t){let e=!1,o={};for(let[r,s]of Object.entries(t))s!=null&&(e=!0,H[r]=s),o[r]=H[r];return e&&G.set(nt,o),e}var W=class extends x.Store{constructor(e,o){super(e,o)}initialize(){let e=G.get(nt);e!=null&&st(e)}getSwitch(){return H.switch}},$=new W(m,t=>{switch(t.type){case"CORDWOOD_SETTINGS_UPDATE":return st(t.settings);default:return!1}});var it={setSwitch(t){m.dispatch({type:"CORDWOOD_SETTINGS_UPDATE",settings:{switch:t}})}};var xt=b("Checkbox"),z=class extends l.Component{constructor(e={}){super(e),this.state={toggled:0}}render(){return l.createElement("div",{className:"margin-top-20"},l.createElement(xt,{onChange:e=>{it.setSwitch(e.target.checked)},defaultChecked:this.props.switch}))}},J=I([$],()=>({switch:$.getSwitch()}))(z);var C=d("defaultRules","parserFor"),ct=d("getDefaultRules","parserFor"),Ot=ct.getDefaultRules(),kt=C.defaultRules.lheading,at=C.defaultRules.link,Tt=C.defaultRules.image,Dt=ct.parserFor({...Ot,image:{...Tt},link:{...at},list:C.defaultRules.list,lheading:{...kt,parse(t,e,o){return{className:/\{(.+?)}/.exec(t[1])[1],level:t[2]==="="?1:2,content:C.parseInline(e,t[1].replace(/\{.+?}/,""),o)}},react(t,e,o){return l.createElement(`h${t.level}`,{key:o.key,className:t.className},e(t.content,o))}},shortlink:{shortlinks:{gh:"github.com",srht:"git.sr.ht"},regex:/^\[(.+?)\]\((.+?):([^\/].+?)\)/,order:at.order-.5,match(t){return this.regex.exec(t)},parse(t,e,o){return{content:C.parseInline(e,t[1],o),target:`https://${this.shortlinks[t[2]]}/${t[3]}`}},react(t,e,o){return l.createElement("a",{href:t.target},e(t.content,o))}}}),lt=({changelog:t})=>l.createElement("div",null,Dt(t.body,!1));function q(){U();let t=d("UserSettingsModalSections");Object.assign(t.UserSettingsModalSections,{CORDWOOD:"CORDWOOD"});let e=d("getUserSettingsModalSections");S("getUserSettingsModalSections",e,(r,s)=>{s.push({section:t.UserSettingsModalSections.CORDWOOD,label:"Cordwood",element:J})});let o=d("TabBarItem","TabBarHeader","TabBarSeparator");S("render",e.default.prototype,(r,s)=>{s.props.children[0].props.children.props.children[1].push(l.createElement(o.TabBarHeader,{className:"cordwood-settings-header"},"Cordwood"),l.createElement(o.TabBarItem,{key:"CORDWOOD"},"Plugins"),l.createElement("div",{className:"cordwood-changelog-button",onClick:()=>{Et(),m.dispatch({type:"CHANGE_LOG_OPEN"})}},"Cordwood Change Log")),s.props.children[0].props.children.props.selectedItem==="CORDWOOD"&&(s.props.children[1].props.children[0].props.children=l.createElement(J,null))})}function Et(){let t=b("MarkdownModal");S("render",t.prototype,(e,o)=>{if(!o.props.className.includes("change-log"))return o;let s=window.cordwood.changelog.replace(/\r/g,"").split(`---changelog---
`).slice(1).map(i=>{let p=!1,u={},y=i.split(`
`).filter(f=>{if(f==="---")return p=!0,!1;if(!p){let h=f.split(": "),w=h.shift(),E=h.join(": ");u[w]=JSON.parse(E)}return p}).join(`
`);return{...u,body:y}})[0],n=o.props.children[0].props.children[0];n[0].props.children="Cordwood Changelog",n[1]=` (${s.date})`;let a=o.props.children[2].props.children;a[1].props.href="https://github.com/Cordwood/Cordwood/blob/master/CHANGELOG.md";let c=o.props.children[1];return c.props.children[0]=null,c.props.children[1]=[l.createElement(lt,{changelog:s})],o},!0)}var K=(t,e,o)=>{console[o]("%cCordwood%c",`background-color: ${e}; color: black; font-weight: 600; border-radius: 16px; padding: 0px 5px 0px 5px;`,"",t)},T={log:t=>K(t,"#b6c76c","log"),warn:t=>K(t,"#e19c3d","warn"),error:t=>K(t,"#a63d40","error")};function D(t,e,{walkable:o=[],ignore:r=[],maxDepth:s=100}={}){let n=0;function a(c,i,{walkable:p=[],ignore:u=[]}={}){if(n+=1,!(n>s)){if(typeof i=="string"){if(c.hasOwnProperty(i))return c[i]}else if(i(c))return c;if(!!c){if(Array.isArray(c))for(let y of c){let f=a(y,i,{walkable:p,ignore:u});if(f)return f}else if(typeof c=="object"){for(let y of Object.keys(c))if(!(p!=null&&p.includes(y))&&!u.includes(y))try{let f=a(c[y],i,{walkable:p,ignore:u});if(f)return f}catch{}}}}}return a(t,e,{walkable:o,ignore:r})}function pt(t,e){D(t,e,{walkable:["props","children","child","sibling"]})}async function Y(t){let e={cache:"no-cache"},o=new URL(t.endsWith("/")?t:t+"/"),r=await fetch(o+"manifest.json",e);if(!r.ok)throw new Error(`Could not load manifest for plugin at ${t}`);let s;try{s=await r.json()}catch{throw new Error(`Could not parse manifest for plugin at ${t}`)}let n;try{n=await(await fetch(o+"index.js",e)).text()}catch{throw new Error(`Could not load main file for plugin at ${t}`)}return{manifest:s,url:o,main:n}}var Rt=window.eval;async function V(t){window.cordwood.plugins.loaded.push(t);let e=Rt(t.main)(window.cordwood);e.onLoad&&e.onLoad()}if(window.cordwood)throw new Error("Cordwood is already injected...");var dt=!1;try{rt(),q(),x.initialize();let t=M(".cordwood-settings-header{padding-bottom:1rem}.cordwood-changelog-button{cursor:pointer;display:block!important;color:#faa61a!important;font-size:12px!important;padding:8px 6px 10px 20px!important;opacity:.7;-webkit-transition:opacity .2s!important;transition:opacity .2s}.cordwood-changelog-button:hover{opacity:1;color:#faa61a}");window.cordwood={utils:{logger:T,findInTree:D,findInReactTree:pt},patcher:{...ot},webpack:{...L,common:{...v}},plugins:{importPlugin:Y,loadPlugin:V,loaded:new Array},uninject:()=>{O(),t(),delete window.cordwood}},fetch("https://raw.githubusercontent.com/Cordwood/Cordwood/master/CHANGELOG.md",{cache:"no-store"}).then(e=>e.text().then(o=>Object.assign(window.cordwood,{changelog:o})))}catch(t){dt=!0,T.error(`Cordwood failed to initialize... ${t.stack?t.stack:t.toString()}`)}dt||T.log("Loaded successfully!");})();
//# sourceURL=Cordwood