"use strict";(()=>{var se=Object.defineProperty;var ke=(e,t,o)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var j=(e,t)=>{for(var o in t)se(e,o,{get:t[o],enumerable:!0})};var A=(e,t,o)=>(ke(e,typeof t!="symbol"?t+"":t,o),o);var M={};j(M,{Flux:()=>T,FluxDispatcher:()=>h,React:()=>i,ReactDOM:()=>Ae});var U={};j(U,{find:()=>R,findAll:()=>I,findByDisplayName:()=>S,findByDisplayNameAll:()=>_e,findByProps:()=>d,findByPropsAll:()=>De,modules:()=>B});var ie=window.webpackJsonp([],[(e,t,o)=>{e.exports=o}]);var ae=(e,t=!1)=>o=>{let r=[];for(let s in e)if(e.hasOwnProperty(s)){let n=e[s].exports;if(!n)continue;if(n.default&&n.__esModule&&o(n.default)){if(t)return n.default;r.push(n.default)}if(o(n)){if(t)return n;r.push(n)}}if(!t)return r},B=ie.c,R=ae(B,!0),I=ae(B),le=e=>t=>e.every(o=>t[o]!==void 0),ce=(e,t)=>t?o=>o.displayName===e:o=>o?.default?.displayName===e,d=(...e)=>R(le(e)),De=(...e)=>I(le(e)),S=(e,t=!0)=>R(ce(e,t)),_e=(e,t=!0)=>I(ce(e,t));var i=d("createElement"),Ae=d("render","findDOMNode"),T=d("Store","initialize"),h=d("_isDispatching","dispatch");var $={};j($,{after:()=>y,before:()=>Ee,instead:()=>ve,unpatchAll:()=>E});var G=["a","b","i"],m=new Map;function pe(e,t,o,r,s){let n=m.get(t)?.[e];if(!n)return s?Reflect.construct(t[e],o,r):t[e].apply(r,o);for(let c of n.b.values()){let p=c.call(r,o);Array.isArray(p)&&(o=p)}let a=(...c)=>s?Reflect.construct(n.o,c,r):n.o.apply(r,c);for(let c of n.i.values()){let p=a;a=(...f)=>c.call(r,f,p)}let l=a(...o);for(let c of n.a.values())l=c.call(r,o,l)??l;return l}function W(e,t,o,r){let s=m.get(e),n=s?.[t];return n?.[r].has(o)?(n[r].delete(o),G.every(a=>n[a].size===0)&&(Reflect.defineProperty(e,t,{value:n.o,writable:!0,configurable:!0})||(e[t]=n.o),delete s[t]),Object.keys(s).length==0&&m.delete(e),!0):!1}function E(){for(let[e,t]of m.entries())for(let o in t)for(let r of G)for(let s of t[o]?.[r].keys()??[])W(e,o,s,r)}var v=e=>(t,o,r,s=!1)=>{if(typeof o[t]!="function")throw new Error(`${t} is not a function in ${o.constructor.name}`);m.has(o)||m.set(o,{});let n=m.get(o);if(!n[t]){let c=o[t];n[t]={o:c,b:new Map,i:new Map,a:new Map};let p=(u,g,b)=>{let F=pe(t,o,g,u,b);return s&&l(),F},f=new Proxy(c,{apply:(u,g,b)=>p(g,b,!1),construct:(u,g)=>p(c,g,!0),get:(u,g,b)=>g=="toString"?c.toString.bind(c):Reflect.get(u,g,b)});Reflect.defineProperty(o,t,{value:f,configurable:!0,writable:!0})||(o[t]=f)}let a=Symbol(),l=()=>W(o,t,a,e);return n[t][e].set(a,r),l};var Ee=v("b"),ve=v("i"),y=v("a");var de=new Array;function Pe(e){let t=document.createElement("style");t.id="CORDWOOD_INJECTED_STYLE",t.innerHTML=e,document.head.appendChild(t),de.push(o);function o(){t.remove()}return o}function H(){for(let e of de)e()}var ue={...$,injectCSS:Pe,clearStyles:H};var Ne=d("showChangeLog");function z(){y("showChangeLog",Ne,()=>{h.dispatch({type:"CHANGE_LOG_OPEN"})})}function Le(e,t,o){if(e===t)return!0;let r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++){let a=r[n];if(e[a]!==t[a]&&(o==null||o.indexOf(a)===-1))return!1}return!0}function Fe(e){return e.displayName||e.name||"Component"}function K(e,t){return o=>class extends i.Component{static displayName=`FluxContainer(${Fe(o)})`;constructor(r){super(r),this.state=t(r),this._handleStoreChange=this._handleStoreChange.bind(this)}_handleStoreChange(){this.setState(t(this.props))}componentWillMount(){e.forEach(r=>{r.addChangeListener(this._handleStoreChange)})}componentWillReceiveProps(r){Le(this.props,r)||this.setState(t(r))}componentWillUnmount(){e.forEach(r=>r.removeChangeListener(this._handleStoreChange))}render(){return i.createElement(o,{...this.props,...this.state},null)}}}function k(e){return new Promise((t,o)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>o(e.error)})}function je(e,t){let o=indexedDB.open(e);o.onupgradeneeded=()=>o.result.createObjectStore(t);let r=k(o);return(s,n)=>r.then(a=>n(a.transaction(t,s).objectStore(t)))}var J;function P(){return J||(J=je("keyval-store","keyval")),J}function fe(e,t=P()){return t("readonly",o=>k(o.get(e)))}function ge(e,t,o=P()){return o("readwrite",r=>(r.put(t,e),k(r.transaction)))}function he(e,t=P()){return t("readwrite",o=>(o.delete(e),k(o.transaction)))}function me(e=P()){return e("readwrite",t=>(t.clear(),k(t.transaction)))}var V=class{async get(t,o=null){let r=await fe(t);return r||(r=o),r}async set(t,o){await ge(t,o)}async remove(t){await he(t)}async clear(){await me()}},C=new V;var ye="CordwoodSettingsStore",Y={fluxLogger:!1};async function we(e){let t=!1,o={};for(let[r,s]of Object.entries(e))s!=null&&(t=!0,Y[r]=s),o[r]=Y[r];return t&&await C.set(ye,o),t}var q=class extends T.Store{constructor(t,o){super(t,o)}async initialize(){let t=await C.get(ye);t!=null&&await we(t)}get fluxLogger(){return Y.fluxLogger}},D=new q(h,async e=>{switch(e.type){case"CORDWOOD_SETTINGS_UPDATE":return await we(e.settings);default:return!1}});var Se={setFlux(e){h.dispatch({type:"CORDWOOD_SETTINGS_UPDATE",settings:{fluxLogger:e}})}};var Be=S("Scroller"),Re=S("Checkbox"),N=class extends i.Component{constructor(t={}){super(t)}render(){return i.createElement(Be,{className:"settings-wrapper settings-panel"},i.createElement("div",{className:"control-groups"},i.createElement("div",{className:"control-group"},i.createElement("label",null,"Debug Settings"),i.createElement("ul",{className:"checkbox-group"},i.createElement("li",null,i.createElement(Re,{onChange:t=>{Se.setFlux(t.target.checked)},defaultChecked:this.props.fluxLogger},"Log everything that passes through the Flux Dispatcher.")),i.createElement("li",null,i.createElement("div",{className:"help-text"},"Note that this will clog up your console."))))))}};A(N,"displayName","SettingsView");var Z=K([D],()=>({fluxLogger:D.fluxLogger}))(N);var x=d("defaultRules","parserFor"),be=d("getDefaultRules","parserFor"),Ie=be.getDefaultRules(),Ue=x.defaultRules.lheading,Ce=x.defaultRules.link,Me=x.defaultRules.image,Ge=be.parserFor({...Ie,image:{...Me},link:{...Ce},list:x.defaultRules.list,lheading:{...Ue,parse(e,t,o){return{className:/\{(.+?)}/.exec(e[1])[1],level:e[2]==="="?1:2,content:x.parseInline(t,e[1].replace(/\{.+?}/,""),o)}},react(e,t,o){return i.createElement(`h${e.level}`,{key:o.key,className:e.className},t(e.content,o))}},shortlink:{shortlinks:{gh:"github.com",srht:"git.sr.ht"},regex:/^\[(.+?)\]\((.+?):([^\/].+?)\)/,order:Ce.order-.5,match(e){return this.regex.exec(e)},parse(e,t,o){return{content:x.parseInline(t,e[1],o),target:`https://${this.shortlinks[e[2]]}/${e[3]}`}},react(e,t,o){return i.createElement("a",{href:e.target},t(e.content,o))}}}),xe=({changelog:e})=>i.createElement("div",null,Ge(e.body,!1));var We="._cordwood-settings-header_1mzwv_1{paddingbottom:1rem}._cordwood-changelog-button_1mzwv_1{display:block;color:#faa61a;font-size:12px;padding:8px 6px 10px 20px;cursor:pointer;opacity:.7;-webkit-transition:opacity .2s ease;transition:opacity .2s ease}._cordwood-changelog-button_1mzwv_1:hover{opacity:1;color:#faa61a}";document.head.appendChild(document.createElement("style")).appendChild(document.createTextNode(We));var Q={cordwoodSettingsHeader:"_cordwood-settings-header_1mzwv_1",cordwoodChangelogButton:"_cordwood-changelog-button_1mzwv_1"};var $e=S("Scroller"),O=class extends i.Component{render(){return i.createElement($e,{className:"settings-wrapper settings-panel"},i.createElement("img",{style:{width:"100%"},src:"https://raw.githubusercontent.com/Cordwood/Cordwood/master/.assets/cordwood-transparent-black.png"}),i.createElement("p",{style:{position:"absolute",bottom:0}},"Made with \u2764\uFE0F by Beef and Alyxia"))}};A(O,"displayName","AboutView");function X(){z();let e=d("UserSettingsModalSections");Object.assign(e.UserSettingsModalSections,{CORDWOOD_ABOUT:"CORDWOOD_ABOUT",CORDWOOD_SETTINGS:"CORDWOOD_SETTINGS",CORDWOOD_PLUGINS:"CORDWOOD_PLUGINS"});let t=d("getUserSettingsModalSections");y("getUserSettingsModalSections",t,(r,s)=>{s.push({section:e.UserSettingsModalSections.CORDWOOD_SETTINGS,label:"Cordwood",element:Z})});let o=d("TabBarItem","TabBarHeader","TabBarSeparator");y("render",t.default.prototype,(r,s)=>{s.props.children[0].props.children.props.children[1].push(i.createElement(o.TabBarHeader,{className:Q.cordwoodSettingsHeader},"Cordwood"),i.createElement(o.TabBarItem,{key:"CORDWOOD_ABOUT"},"About"),i.createElement(o.TabBarItem,{key:"CORDWOOD_SETTINGS"},"Settings"),i.createElement("div",{className:Q.cordwoodChangelogButton,onClick:()=>{He(),h.dispatch({type:"CHANGE_LOG_OPEN"})}},"Cordwood Change Log")),s.props.children[0].props.children.props.selectedItem==="CORDWOOD_ABOUT"&&(s.props.children[1].props.children[0].props.children=i.createElement(O,null)),s.props.children[0].props.children.props.selectedItem==="CORDWOOD_SETTINGS"&&(s.props.children[1].props.children[0].props.children=i.createElement(Z,null))})}function He(){let e=S("MarkdownModal");y("render",e.prototype,(t,o)=>{if(!o.props.className.includes("change-log"))return o;let s=window.cordwood.changelog.replace(/\r/g,"").split(`---changelog---
`).slice(1).map(c=>{let p=!1,f={},w=c.split(`
`).filter(u=>{if(u==="---")return p=!0,!1;if(!p){let g=u.split(": "),b=g.shift(),F=g.join(": ");f[b]=JSON.parse(F)}return p}).join(`
`);return{...f,body:w}})[0],n=o.props.children[0].props.children[0];n[0].props.children="Cordwood Changelog",n[1]=` (${s.date})`;let a=o.props.children[2].props.children;a[1].props.href="https://github.com/Cordwood/Cordwood/blob/master/CHANGELOG.md";let l=o.props.children[1];return l.props.children[0]=null,l.props.children[1]=[i.createElement(xe,{changelog:s})],o},!0)}var ee=(e,t,o)=>{console[o]("%cCordwood%c",`background-color: ${t}; color: black; font-weight: 600; border-radius: 16px; padding: 0px 5px 0px 5px;`,"",e)},L={log:e=>ee(e,"#b6c76c","log"),warn:e=>ee(e,"#e19c3d","warn"),error:e=>ee(e,"#a63d40","error")};function _(e,t,{walkable:o=[],ignore:r=[],maxDepth:s=100}={}){let n=0;function a(l,c,{walkable:p=[],ignore:f=[]}={}){if(n+=1,!(n>s)){if(typeof c=="string"){if(l.hasOwnProperty(c))return l[c]}else if(c(l))return l;if(!!l){if(Array.isArray(l))for(let w of l){let u=a(w,c,{walkable:p,ignore:f});if(u)return u}else if(typeof l=="object"){for(let w of Object.keys(l))if(!(p!=null&&p.includes(w))&&!f.includes(w))try{let u=a(l[w],c,{walkable:p,ignore:f});if(u)return u}catch{}}}}}return a(e,t,{walkable:o,ignore:r})}function te(e,t){_(e,t,{walkable:["props","children","child","sibling"]})}function oe(e){let t=new Array;for(let[o,r]of Object.entries(e)){let s=Object.entries(r).map(([n,a])=>`${n.replace(/[A-Z]/g,l=>`-${l.toLowerCase()}`)}:${a}`).join(";");t.push(`${o}{${s}}`)}return t.join("")}async function re(e){let t={cache:"no-cache"},o=new URL(e.endsWith("/")?e:e+"/"),r=await fetch(o+"manifest.json",t);if(!r.ok)throw new Error(`Could not load manifest for plugin at ${e}`);let s;try{s=await r.json()}catch{throw new Error(`Could not parse manifest for plugin at ${e}`)}let n;try{n=await(await fetch(o+"index.js",t)).text()}catch{throw new Error(`Could not load main file for plugin at ${e}`)}return{manifest:s,url:o,main:n}}var ze=window.eval;async function ne(e){window.cordwood.plugins.loaded.push(e);let t=ze(e.main)(window.cordwood);t.onLoad&&t.onLoad()}var Oe=()=>y("dispatch",h,e=>{D.fluxLogger&&console.log(e[0])});if(window.cordwood)throw new Error("Cordwood is already injected...");var Te=!1;try{X(),T.initialize(),Oe(),window.cordwood={utils:{logger:L,findInTree:_,findInReactTree:te,storage:{get:C.get,set:C.set,remove:C.remove,clear:C.clear},createStyle:oe},patcher:{...ue},webpack:{...U,common:{...M}},plugins:{importPlugin:re,loadPlugin:ne,loaded:new Array},uninject:()=>{E(),H(),delete window.cordwood}},fetch("https://raw.githubusercontent.com/Cordwood/Cordwood/master/CHANGELOG.md",{cache:"no-store"}).then(e=>e.text().then(t=>Object.assign(window.cordwood,{changelog:t})))}catch(e){Te=!0,L.error(`Cordwood failed to initialize... ${e.stack?e.stack:e.toString()}`)}Te||L.log("Loaded successfully!");})();
//# sourceURL=Cordwood